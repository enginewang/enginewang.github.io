---
title: "路由器折腾记录"
date: 2021-06-17T13:43:38+08:00
draft: false
categories: ["生活"]
tags: ["路由器", "网络", "Linux"]
---

简要记录一下对路由器的折腾记录，只是一部分，剩下的后面有空就慢慢补上。

路由器成了我们生活必不可缺的一个产品，而且建议拥有自己的一台路由器，起码能对自身的网络环境有一定的掌握，还可以通过一些操作使得自己的生活更便捷。

大部分人对路由器的认知只是一个释放无线信号给设备连接wifi的产品，但是实际上路由器的功能远不止于此。

推荐有固件的路由器，比如梅林或者openwrt，因为我的是梅林，所以这里就只基于梅林固件来讲。

## 准备

### 一个能刷梅林的路由器


最关键的点，普通路由器也没啥可折腾的，我用的是ASUS RT-AC68u，这款14年的产品到现在依然坚挺，并且全新的还能卖到400-600，也是够离谱的。当然如果需要更新更好的路由器，也可以在这里挑选一下喜欢的型号，反正越贵越好，按需购买，有钱就上带X的路由器，保证速度嘎嘎快。
[https://www.koolcenter.com/category/merlin](https://www.koolcenter.com/category/merlin)

其实去闲鱼捡二手也不错，我的另一台RT-AC68u就是花了一百多从闲鱼捡的，表面伤痕累累没关系，功能没啥问题就行。


第一次连接，路由器开机之后就会看到wifi列表里有ASUS，用一台设备（推荐电脑）连接wifi，当然这里直接连网线也是一样的。然后就会进入到初始设置页面，没自动进入的话就打开`router.asus.com`或者`192.168.50.1`（也可能是其他ip，看实际情况）手动进入，配置宽带账号密码、管理员账户密码、wifi名称密码等等。

然后就进入了路由器后台，这里的可玩性比普通路由器高太多了

![](https://s2.loli.net/2022/11/25/LWnIuE4OtgK6V8k.png)


### 闲置移动硬盘（可选）

主要是做nas用，因为这些进阶版的路由器基本都有几个usb插孔，可以接存储设备，可以接移动机械硬盘/移动ssd，也可以买一个拓展坞接机械硬盘/ssd。考虑到带宽，其实机械硬盘就够了，固态属于大炮打蚊子。

### 闲置U盘一个（可选）

小的就行，如果应用起的多，需要一个u盘来做虚拟内存，当然没有也没事

### 公网ip（可选）

可以通过租云服务器来获得，主要是为了内网穿透，当然不配内网穿透的话就不用管这个，如果有一个域名那也是极好的，没有也没关系

## 刷Koolshare梅林固件

华硕自带的固件虽然功能很多，但是没有软件中心，可玩性大打折扣，这里需要刷Koolshare的改版梅林。

还是在这里，选择自己的路由器型号，然后翻到最下面下载固件。
[https://www.koolcenter.com/category/merlin](https://www.koolcenter.com/category/merlin)

路由器后台页面，前往“系统管理-固件升级”，然后上传下载的固件，安装新的固件即可。

![](https://s2.loli.net/2022/11/25/vIb4k8YAVh5CWjL.png)

再次启动进入后台，就可以看到软件中心了。

![](https://s2.loli.net/2022/11/25/knIY23b6KDou7XZ.png)

## 初始设置

开启ssh：
系统管理-系统设置-服务-开启ssh

这样就可以远程ssh登录了

## NAS

进入路由后台，

（68u有一个USB3.0一个USB2.0，建议USB3.0接移动硬盘做NAS，USB2.0接一个小U盘做虚拟内存，供日后的内网穿透和v2ray等使用）

建议先插虚拟内存，待完成挂载和建立交换分区的操作后再插入移动硬盘。

usb驱动页面找到samba共享与ftp共享

重要的是下面的权限配置，管理员肯定是全权限，如果要和其他用户共享网络文件，可以指定文件夹赋予不同权限。硬盘直接NTFS格式就可以读取的。或者格式化为ext4。

![](https://s2.loli.net/2022/11/25/DSGniZYWs3FyxR1.png)

## 内网穿透

具体的教程见我的这篇文章的后面部分：[frp内网穿透原理及配置记录](http://blog.engine.wang/posts/frp-notes)

## 虚拟内存

本来虚拟内存挂一下U盘就能解决，结果我在我的ASUS RT-AC68u路由器的后台页面一直看到的未加载，明明已经格式化为ext4了

记录一下解决方法：

1.ssh连接路由器

和连接服务器一样，只是把ip改成192.168.50.1即可

2.fdisk -l 查看U盘在哪个区

比如在`/dev/sda1`

3.在路由器上格式化U盘

`mkfs.ext2 /dev/sda1`

4.建立一个挂在区，挂载U盘

`mkdir /mnt/usb`

`mount -t ex2 /dev/sda1 /mnt/usb`


理论上不会报错，这时候刷新路由器后台页面，就会显示U盘已经挂载了，就可以使用虚拟内存了

## 科学上网

### fancyssr下载

先下载对应的安装包：

https://github.com/hq450/fancyss_history_package/tree/master/fancyss_arm

### 允许安装

直接上传如果报错：

检测到离线安装包：含非法关键词！！！
根据法律规定，koolshare软件中心将不会安装此插件！！！

则需要登录路由器，运行下面的命令即可安装成功：

```
$ sed -i 's/\tdetect_package/\t# detect_package/g' /koolshare/scripts/ks_tar_install.sh
```

然后自行配置订阅、选择节点和开启服务，所有连接到此路由器的设备都能直连外网。